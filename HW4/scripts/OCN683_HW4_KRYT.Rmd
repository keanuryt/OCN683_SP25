---
author: 'Keanu Rochette '
date: '`r format(Sys.Date())`'
title: HW 4 - Copepods
output: 
  html_document: 
    toc: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE)
```

## Load libraries
```{r}
library(tidyverse)
library(here)
library(janitor)
library(arm)
library(VGAM)
library(MASS)

```

## Load Data
```{r}
copepods  <- read_csv(here("HW4", "data","dam_acartia_survival_subset.csv"))
fish <- read_csv(here("HW4", "data","yellowtang.csv"))
```

```{r}
copepods <- copepods %>% clean_names() %>% rename (ph = p_h)
fish <- fish %>% clean_names()
```


## Question 1: Binomial Distribution
```{r}
discrete.histogram(copepods$nx)
```

## Question 2
Without consideration of the binomial distribution, the variance is 18.3. This is because the variance is calculated based on the number of copepods counted in a specific mesocosm, not based on the survival probability. Here a key aspect of the data analysis is based on the initial number of copepod in a tank and how many of those survived. Because the output of the experiement is either "dead" or "alive", this data set can be considered Binomially distributed.  
In a binomial distribution, the value of variance is deterministic and depends on the mean. According to the Bernoulli distribution, variance = p*(1-p) where p is the probability of success. Here, the probability of success is the probability of having live copepods in a tank.  

```{r}
copepods %>%  filter(nx > 0) %>% 
  summarise(alive = sum(nx), # count the total number of live copepods
            mean = mean(nx), # calculating the mean
            variance = var(nx)) %>% # variance in non-bernoulli conditions
  mutate(dead = (91*25)-alive, # calculate the n of dead ones based on initial number
         proba_survival = alive/(91*25), # survival probability = live/total intial
         variance_binom = proba_survival*(1-proba_survival)) # calculate the variance based on the Bernoulli distribution 

```

## Question 3

```{r}
#generating 5 sets of data
q3_binom <- tibble(V1 = rbinom(n=91, size = 25, prob = 0.695),
       V2 = rbinom(n=91, size = 25, prob = 0.695),
       V3 = rbinom(n=91, size = 25, prob = 0.695),
       V4 = rbinom(n=91, size = 25, prob = 0.695),
       V5 = rbinom(n=91, size = 25, prob = 0.695))

head(q3_binom, 20)
```


```{r}
q3_binom %>% pivot_longer(cols = V1:V5,
                          names_to = "data", 
                          values_to = "values") %>% 
  group_by(data) %>% 
  summarise(alive = sum(values), # count the total number of survivors
            mean = mean(values),
            variance = var(values)) %>% #calculating the mean
  mutate(dead = (91*25)-alive, # calculate the n of dead ones based on initial number
         proba_survival = alive/(91*25), # survival probability = live/total intial
         variance_binom = proba_survival*(1-proba_survival))
```

```{r}
par(mfrow = c(3,2))
discrete.histogram(q3_binom$V1, main = "Trial 1")
discrete.histogram(q3_binom$V2, main = "Trial 2")
discrete.histogram(q3_binom$V3, main = "Trial 3")
discrete.histogram(q3_binom$V4, main = "Trial 4")
discrete.histogram(q3_binom$V5, main = "Trial 5")
```


### Answer Q3

The histograms generated by rbinom() have a more "bell curve" shape whereas the histogram in the data provided is skewed. A lot of the data is concentrated to the right side of the plot and there is also a non-negligible portion of 0 survival, to the left of the curve.  
The rbinom() function is generating numbers at random based on the parameters that were given it. The copepod data is the result of more complex processes that interact with one another which resulted in the probability calculated. Mortality of copepods in mesocosm can be caused by other factors such as heat, nutrient availability, water quality, water residence time...etc. Those other factors are not distributed equally across tanks and this may have skewed the curve of the copepod data. 


## Question 4 

Below is the code I used to try different values of rho to match the shape of the histogram of the observed data. However, because new data is generated every time the code is run, I saved the image of the graphs that gave me the best fit. According to the image below, rho=3 fits the observed copepod data the best.

```{r, fig.height= 8, fig.width= 6}
par(mfrow = c(4,2))
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0),
                   main= "rho = 1")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 1),
                   main= "rho = 0")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0.75),
                   main= "rho = 0.75")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0.55),
                   main= "rho = 0.55")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0.4),
                   main= "rho = 0.4")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0.3),
                   main= "rho = 0.3")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0.2),
                   main= "rho = 0.2")
discrete.histogram(rbetabinom(n= 91,  size = 25, prob = 0.695, rho = 0.285),
                   main= "rho = 0.285")

```

### Saved the results

![Beta Binomial Distribution](/Users/keanurochette/Desktop/Git Hub Repository/OCN683_SP25/HW4/outputs/beta_binom.png)


## Question 5: Poisson Distribution 

```{r}
discrete.histogram(fish$count)
```

## Question 6
Without consideration of the Poisson distribution, the variance is 35.97 because the data varies a lot. However, most of the frequency of data point is concentrated towards the left side of the graph (close to 0) because the probability of encountering a yellowtang fish is small. As a result, this fits the criteria to consider this data set as Poisson distributed. With the Poisson Distribution, the mean and the variance are the same, i.e. 5.03.
```{r}
fish %>% summarize(mean = mean(count),
                   variance = var(count), 
                   variance_poisson= mean)
```


## Question 7

```{r}
# I chose n = 1373 because the data set has 1373 observations of yellow tang
q7_poisson <- tibble(V1 = rpois(n= 1373, lambda = 5.026948),
                     V2 = rpois(n= 1373, lambda = 5.026948),
                     V3 = rpois(n= 1373, lambda = 5.026948),
                     V4 = rpois(n= 1373, lambda = 5.026948),
                     V5 = rpois(n= 1373, lambda = 5.026948))

head(q7_poisson, 20)
```

```{r}
q7_poisson %>% pivot_longer(cols = V1:V5,
                          names_to = "data", 
                          values_to = "values") %>% 
  group_by(data) %>%
  summarize(mean = mean(values),
            variance = var(values))
# note that mean and variance the same in a Poisson distribution and they are labeled "lambda"
```


```{r}
par(mfrow = c(3,2))
discrete.histogram(q7_poisson$V1, main = "Trial 1")
discrete.histogram(q7_poisson$V2, main = "Trial 2")
discrete.histogram(q7_poisson$V3, main = "Trial 3")
discrete.histogram(q7_poisson$V4, main = "Trial 4")
discrete.histogram(q7_poisson$V5, main = "Trial 5")

```

### Answer Q7

The generated data sets have histogram that are more centered around x = 4 and 5. The observed data has a curve that is closer to x=0 indicating a very low probability of counting a yellow tang fish. This may be due to unaccounted factors such as avoidance behavior from the person surveying the area. 

## Question 8
Below is the code I used to try different values of theta to match the shape of the histogram of the observed data. However, because new data is generated every time the code is run, I saved the image of the graphs that gave me the best fit.  

From the trials below, we can see that theta = 1.5 results in a graph that is the most similar to the histogram of observed data. 
```{r, fig.height= 8, fig.width= 6}
par(mfrow = c(3,2))
discrete.histogram(rnegbin(n=1373, mu = 5.026948, theta= 0.1), 
                   main = "Theta = 0.5")
discrete.histogram(rnegbin(n=1373, mu = 5.026948, theta= 0.5), 
                   main = "Theta = 0.5")
discrete.histogram(rnegbin(n=1373, mu = 5.026948, theta= 1), 
                   main = "Theta = 1")
discrete.histogram(rnegbin(n=1373, mu = 5.026948, theta= 2), 
                   main = "Theta = 2")
discrete.histogram(rnegbin(n=1373, mu = 5.026948, theta= 1.5), 
                   main = "Theta = 1.5")
discrete.histogram(rnegbin(n=1373, mu = 5.026948, theta= 1.7), 
                   main = "Theta = 1.7")

```

### Saving the results

![poisson distribution](/Users/keanurochette/Desktop/Git Hub Repository/OCN683_SP25/HW4/outputs/poisson.png)